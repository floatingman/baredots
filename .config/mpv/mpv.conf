# ==========    GENERAL    ==========
#
# This is what profile=high-quality do:
# scale=ewa_lanczossharp (This also changes the cscale)
# hdr-peak-percentile=99.995
# hdr-contrast-recovery=0.30
fullscreen=no                                   # Don't start in fullscreen
force-seekable=yes                              # If the player thinks that the media is not seekable, force enable seeking
keep-open=no                                    # Close the player after finishing the video,
                                                # and playback will never automatically advance to the next file in the playlist
hwdec=auto
vd-lavc-dr=yes
vd-lavc-threads=4
vo=gpu-next
profile=sw-fast
hdr-compute-peak=no
# idle=yes
log-file="~~/files/mpv.log"
save-position-on-quit=yes
write-filename-in-watch-later-config
#ignore-path-in-watch-later-config
resume-playback-check-mtime=yes
watch-later-directory="~~/cache/watch_later"
watch-later-options=start,vid,aid,sid
reset-on-next-file=vf,af,loop-file,deinterlace,contrast,brightness,gamma,saturation,hue,video-zoom,video-rotate,video-pan-x,video-pan-y,panscan,speed,audio,sub,audio-delay,sub-pos,sub-scale,sub-delay,sub-speed,sub-visibility

                                                # it will automatically play the file instead of a paused state

# ==========    SCALERS AND SHADERS    ==========

# Default was:
# dscale=hermite (because of mpv 0.37.0)
# cscale=ewa_lanczossharp (because of profile=high-quality)

# scale=ewa_lanczossharp                          # Luma upscaler
# dscale=mitchell                                 # Luma downscaler
# cscale=ewa_lanczossoft                          # Chroma up&downscaler
#
# gpu-shader-cache-dir='~~/cache/shaders_cache'         # https://mpv.io/manual/stable/#options-gpu-shader-cache-dir

# FSRCNNX (more powerful, but tend to cause overshoot), use nnedi13 (below) instead if you notice dropped frames
# glsl-shader="~~/shaders/FSRCNNX_x2_16-0-4-1.glsl"  # Luma upscaler

# nnedi3
# use nns128 instead of nns256 if you notice dropped frames
# glsl-shader="~~/shaders/nnedi3-nns256-win8x4.hook"  # Luma upscaler 
# glsl-shader="~~/shaders/nnedi3-nns128-win8x4.hook"  # Luma upscaler
# no-scaler-resizes-only                          # Fixing the pixel shift https://mpv.io/manual/stable/#options-scaler-resizes-only

# SSimDownscaler
# glsl-shader="~~/shaders/SSimDownscaler.glsl"    # Luma downscaler

# KrigBilateral (people say it's bloat/overkill)
# glsl-shader="~~/shaders/KrigBilateral.glsl"     # Chroma up&downscaler




# ==========    CACHE    ==========
cache=yes
# cache-on-disk=yes
# cache-dir="C:\mpv-cache"
demuxer-max-bytes=1000MiB
demuxer-readahead-secs=300
demuxer-max-back-bytes=200MiB




# ==========    DEBANDING    ==========

# Banding is a visual artifact, visual artifacts should never be in a video. 
# Example of banding: https://imgur.com/32d77H0
# Debanding is the process of removing said banding.
# 6 minute explanation of what causes banding: https://www.youtube.com/watch?v=h9j89L8eQQk

deband=no                                       # Turn on only for videos with banding. (Keybind=d)
deband-iterations=2                             # https://mpv.io/manual/stable/#options-deband-iterations
deband-threshold=64                             # https://mpv.io/manual/stable/#options-deband-threshold
deband-range=17                                 # https://mpv.io/manual/stable/#options-deband-range
deband-grain=12                                 # https://mpv.io/manual/stable/#options-deband-grain




# ==========    ON SCREEN DISPLAY AND ON SCREEN CONTROLLER    ==========

osd-bar=no                                      # Don't show a huge volume box on screen when turning the volume up/down
osc=no                                          # Allows for custom OSC to be used  https://github.com/cyl0/mpv-osc-morden-x
border=no                                       # Optional for modern OSC, but recommended
cursor-autohide-fs-only=yes                     # If this option is given, the cursor is always visible in windowed mode
                                                # In fullscreen mode, the cursor is shown or hidden according to --cursor-autohide
cursor-autohide=300                             # Cursor hide in ms   
osd-level=1                                     # https://mpv.io/manual/stable/#options-osd-level
osd-duration=1000                               # Set the duration of the OSD messages in ms
hr-seek=yes                                     # Select when to use precise seeks that are not limited to keyframes
                                                # https://mpv.io/manual/stable/#options-hr-seek

osd-font='SamsungOne-400'
osd-font-size=32
osd-color='#FFFFFF'                             # Hex code for white
osd-border-color='#000000'                      # Hex code for black
osd-border-size=0.6                             # Size for osd text and progress bar
osd-blur=0.2                                    # Gaussian blur factor. 0 means no blur applied (default)




# ==========    LANGUAGE PRIORITY    ==========

alang=ja,jp,jpn,en,eng                          # Audio language priority
slang=en,eng                                    # Subtitle language priority




# ==========    AUDIO    ==========

volume=100                                      # default volume, 100 = unchanged
audio-file-auto=fuzzy                           # Load external audio with (almost) the same name as the video
volume-max=200                                  # Max volume of the player
audio-pitch-correction=yes                      # https://mpv.io/manual/stable/#options-audio-pitch-correction
audio-device=auto
audio-channels=7.1,5.1,stereo



# ==========    SUBTITLES    ==========

demuxer-mkv-subtitle-preroll=yes                # https://mpv.io/manual/stable/#options-mkv-subtitle-preroll
sub-ass-vsfilter-blur-compat=no                 # https://mpv.io/manual/stable/#options-sub-ass-vsfilter-aspect-compat
sub-fix-timing=no                               # https://mpv.io/manual/stable/#options-sub-fix-timing
sub-auto=fuzzy                                  # https://mpv.io/manual/stable/#options-no-sub-auto
                                                # Load all subs containing the media filename 

# The following options only apply to subtitles without own styling
sub-font='Netflix Sans Medium'                  # Specify font to use for subtitles that do not themselves specify a particular font
sub-font-size=40
sub-color='#FFFFFFFF'
sub-border-color='#FF000000'
sub-border-size=2.0
sub-shadow-offset=0
sub-spacing=0.0




# ==========    SCREENSHOT    ==========

screenshot-format=png                           # Output format of screenshots
screenshot-high-bit-depth=yes                   # Same output bitdepth as the video. Set it "no" if you want to save disc space
screenshot-png-compression=1                    # Compression of the PNG picture (1-9).
                                                # Higher value means better compression, but takes more time
screenshot-directory="~/Pictures/mpv-screenshots"           # Output directory
screenshot-template="%f-%wH.%wM.%wS.%wT-#%#00n"             # Name format (filename-hour-minute-second-milisecond-number)




# ==========    INTERPOLATION    ==========

# blend-subtitles=yes                             # Subtitle blending in scenechanges (smoother effect)
# video-sync=display-resample                     # Set the fps as the max of your monitor refresh rate
                                                # (only useful and needed with "interpolation=yes)
# interpolation=yes                               # Enable interpolation
# tscale=oversample                               # Interpolation method




# ==========    PROFILES    ==========

# [HDR]
#     profile-desc=Tone mapping using reinhard
#     profile-restore=copy-equal
#     tone-mapping=reinhard
#     tone-mapping-param=0.6
#     hdr-compute-peak=no
#     blend-subtitles=video
#
# [Clip]
#     profile-desc=Tone mapping using clip
#     profile-restore=copy-equal
#     tone-mapping=clip
#
# [Mobius]
#     profile-desc=Tone mapping using mobius
#     profile-restore=copy-equal
#     tone-mapping=mobius
#
# [Hable]
#     profile-desc=Tone mapping using hable
#     profile-restore=copy-equal
#     tone-mapping=hable
#
# [bt.2390]
#     profile-desc=Tone mapping using bt.2390
#     profile-restore=copy-equal
#     tone-mapping=bt.2390
#
# [Gamma]
#     profile-desc=Tone mapping using gamma
#     profile-restore=copy-equal
#     tone-mapping=gamma
#
# [Linear]
#     profile-desc=Tone mapping using linear
#     profile-restore=copy-equal
#     tone-mapping=linear




# ==========    AUTO PROFILES    ==========

# Auto profiles that automatically applies for WEB-DL anime that need some debanding

# [WEB-DL]
#     profile-desc=WEB-DL Anime (HatSubs, SubsPlease, HorribleSubs, Erai-raws)
#     profile-cond=string.match(p.filename, "HatSubs")~=nil or string.match(p.filename, "SubsPlease")~=nil or string.match(p.filename, "HorribleSubs")~=nil or string.match(p.filename, "Erai%-raws")~=nil
#     deband=yes

# [Mini-Encode #1]
#     profile-desc=Mini Encode Anime 1
#     profile-cond=string.match(p.filename, "ASW")~=nil or string.match(p.filename, "DKB")~=nil or string.match(p.filename, "Judas")~=nil
#     deband=yes

# [Mini-Encode #2]
#     profile-desc=Mini Encode Anime 2
#     profile-cond=string.match(p.filename, "Cerberus")~=nil or string.match(p.filename, "Nep%_Blanc")~=nil or string.match(p.filename, "Reaktor")~=nil
#     deband=yes

# [Mini-Encode #3]
#     profile-desc=Mini Encode Anime 3
#     profile-cond=string.match(p.filename, "Cleo")~=nil or string.match(p.filename, "Akihito")~=nil or string.match(p.filename, "Reaktor")~=nil
#     deband=yes

# [Mini-Encode #4]
#     profile-desc=Mini Encode Anime 4
#     profile-cond=string.match(p.filename, "Ember")~=nil 
#     deband=yes

[rot-fix]
#issue: https://github.com/mpv-player/mpv/issues/8223
profile-desc=Fix the chroma destruction of the rotation output
profile-cond=(p["video-params/rotate"] == 90 or p["video-params/rotate"] == 270) and p.current_vo ~= "gpu-next"
profile-restore=copy
hwdec=no
glsl-shaders=""
#
[video-sync]
profile-cond=(speed*audio_speed_correction) > 0 and ((speed*audio_speed_correction) < 0.96 or (speed*audio_speed_correction) > 1.04) and not (p["estimated-vf-fps"] > 47 or p["display-fps"] > 120)
profile-restore=copy-equal
video-sync=display-resample
#
[fps-fix]
profile-desc=Fix the abnormal energy consumption or drop frame caused by the high refresh rate of the video frame rate and display rate
profile-cond=p["estimated-vf-fps"] > 47 or p["display-fps"] > 120
profile-restore=copy
video-sync=audio
#
[8k-fix]
profile-desc=Using D3D11VA hard solution on 8KAV1 to solve the frame loss problem. This scheme is limited to --gpu-api=d3d11 is available
profile-cond=p["video-params/w"] > 7000 or p["video-params/h"] > 3000
profile-restore=copy
hwdec=auto-safe
video-sync=audio
#
[audio-filter]
profile-desc=When the audio channel is greater than 2, the dynamic range adjustment filter is used for dual channel equipment
profile-cond=p["audio-params/channel-count"] > 2
profile-restore=copy-equal
af-pre=@dynaudnorm:lavfi=[dynaudnorm=g=5:f=250:r=0.9:p=0.5]
#
[pause]
profile-desc=Disable the top when pause
profile-cond=pause
profile-restore=copy
ontop=no

[fullscreen]
profile-desc=Full-screen automatic top
profile-cond=fullscreen or window_maximized
profile-restore=copy
ontop

[minimized]
profile-desc=Pause when minimizing
profile-cond=window_minimized and vid and not p["current-tracks/video/albumart"]
profile-restore=copy-equal
pause
#
[end]
profile-desc=Exit the full screen after the playlist is over
profile-cond=idle_active
no-fullscreen
no-window-maximized
#
[media-title]
profile-desc=Switch window title display content under special protocol
profile-cond=path:find('://') ~= nil or path:find('^magnet:') ~= nil
profile-cond=demuxer_via_network==true
profile-restore=copy
title=${?pause==yes:‚è∏}${?mute==yes:üîá}${?ontop==yes:üìå}${media-title}


#Limit streaming to 1080p
ytdl-format="bestvideo[height<=?1080]+bestaudio/best"

ytdl-raw-options=ignore-config=,sub-lang="en,eng,enUS,en-US",write-sub=,write-auto-sub=

# Use yt-dlp
script-opts=ytdl_hook-ytdl_path=/usr/bin/yt-dlp

[extension.gif]
loop-file=yes               # Loop gifs
